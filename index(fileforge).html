<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileForge - Cyberpunk Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root { 
            --neon-green: #00ff9d; 
            --neon-purple: #bc13fe;
            --neon-blue: #01ffff;
            --bg-dark: #050505;
        }

        /* 1. Animated Background */
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            color: #fff;
            overflow-x: hidden;
            background: linear-gradient(-45deg, #050505, #120422, #02101a, #0b0b0b);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 2. Neon Writing & Animations */
        h1 {
            text-align: center;
            font-size: 3rem;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 5px;
            margin-bottom: 40px;
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px var(--neon-purple), 0 0 40px var(--neon-purple);
            animation: neonPulse 2s infinite alternate;
        }

        @keyframes neonPulse {
            from { text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px var(--neon-purple), 0 0 40px var(--neon-purple); }
            to { text-shadow: 0 0 2px #fff, 0 0 5px #fff, 0 0 10px var(--neon-purple), 0 0 20px var(--neon-purple); opacity: 0.8; }
        }

        .dashboard {
            max-width: 1300px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        /* 3. Glassmorphism Panels */
        .panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
            transition: transform 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(1, 255, 255, 0.2);
        }

        h2 {
            color: var(--neon-blue);
            font-size: 1.2rem;
            text-transform: uppercase;
            margin-top: 0;
            border-bottom: 1px solid rgba(1, 255, 255, 0.3);
            padding-bottom: 10px;
            text-shadow: 0 0 10px rgba(1, 255, 255, 0.5);
        }

        .drop-zone {
            border: 2px dashed var(--neon-purple);
            padding: 40px;
            text-align: center;
            border-radius: 15px;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.3);
            transition: 0.3s;
            color: var(--neon-purple);
            font-weight: bold;
        }

        .drop-zone:hover {
            background: rgba(188, 19, 254, 0.1);
            box-shadow: inset 0 0 15px var(--neon-purple);
        }

        /* Form Inputs */
        label { font-size: 0.7rem; color: #888; text-transform: uppercase; display: block; margin: 15px 0 5px; letter-spacing: 1px; }
        select, input, textarea {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            color: var(--neon-green);
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            outline: none;
        }
        select:focus, input:focus { border-color: var(--neon-green); box-shadow: 0 0 10px rgba(0, 255, 157, 0.3); }

        textarea { height: 120px; font-family: 'Courier New', monospace; }

        /* Neon Buttons */
        button {
            background: transparent;
            color: var(--neon-green);
            border: 2px solid var(--neon-green);
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }

        button:hover {
            background: var(--neon-green);
            color: #000;
            box-shadow: 0 0 20px var(--neon-green);
        }

        .btn-alt {
            color: var(--neon-blue);
            border-color: var(--neon-blue);
        }
        .btn-alt:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        #status-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 30px;
            border-radius: 50px;
            background: var(--neon-green);
            color: #000;
            font-weight: bold;
            display: none;
            z-index: 1000;
            box-shadow: 0 0 20px var(--neon-green);
        }

        .file-item {
            background: rgba(255, 255, 255, 0.05);
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            border-left: 3px solid var(--neon-purple);
        }
    </style>
</head>
<body>

<h1>FileForge Pro</h1>

<div id="status-bar">SYSTEM UPDATED</div>

<div class="dashboard">
    <div class="panel">
        <h2>[01] UPLOAD_STATION</h2>
        <div class="drop-zone" onclick="document.getElementById('fileIn').click()">
            SYNC FILES HERE
            <input type="file" id="fileIn" multiple style="display:none" onchange="handleFiles()">
        </div>
        <div id="fileList" style="margin-top:20px; max-height: 150px; overflow-y:auto;"></div>
        <button class="btn-alt" onclick="clearQueue()">WIPE_QUEUE</button>
    </div>

    <div class="panel">
        <h2>[02] TEXT_LAB</h2>
        <textarea id="textInput" placeholder="> Input raw data here..."></textarea>
        <label>Export Protocol:</label>
        <select id="textTarget">
            <option value="txt">DAT_FILE (.txt)</option>
            <option value="pdf">DOC_ENCRYPT (.pdf)</option>
            <option value="xlsx">GRID_DATA (.xlsx)</option>
            <option value="png">IMG_RENDER (.png)</option>
        </select>
        <button onclick="processTextLab()">EXECUTE_CONVERSION</button>
    </div>

    <div class="panel">
        <h2>[03] CORE_ENGINE</h2>
        <label>System Output</label>
        <select id="batchTarget">
            <option value="jpeg">JPEG_Standard</option>
            <option value="png">PNG_Alpha</option>
            <option value="webp">WebP_Optimized</option>
            <option value="scanned">Scan_Imitation</option>
            <option value="pdf-combined">Merged_PDF</option>
            <option value="zip">Compressed_ZIP</option>
        </select>

        <label>Target Bit-Size</label>
        <div style="display:flex; gap:10px">
            <input type="number" id="sizeVal" value="500">
            <select id="sizeUnit" style="width: 100px;">
                <option value="kb">KB</option>
                <option value="mb">MB</option>
            </select>
        </div>

        <button onclick="startBatch()">START_BATCH_PROCESS</button>
        <button class="btn-alt" onclick="generateDummy()">GENERATE_NULL_FILE</button>
        <button class="btn-alt" onclick="inflateBatch()">INFLATE_DATA</button>
    </div>
</div>

<script>
    let queue = [];

    function showStatus(msg) {
        const bar = document.getElementById('status-bar');
        bar.textContent = "> " + msg;
        bar.style.display = 'block';
        setTimeout(() => bar.style.display = 'none', 3000);
    }

    function handleFiles() {
        const files = document.getElementById('fileIn').files;
        for (let f of files) { queue.push(f); }
        renderQueue();
    }

    function renderQueue() {
        const list = document.getElementById('fileList');
        list.innerHTML = queue.map(f => `<div class="file-item"><span>${f.name}</span><span>${(f.size/1024).toFixed(1)}KB</span></div>`).join('');
    }

    function clearQueue() { queue = []; renderQueue(); showStatus("QUEUE_CLEARED"); }

    async function processTextLab() {
        const text = document.getElementById('textInput').value;
        if (!text) return alert("NO_DATA_FOUND");
        const target = document.getElementById('textTarget').value;
        const name = "output_" + Date.now();

        if (target === 'txt') saveAs(new Blob([text]), name + ".txt");
        else if (target === 'pdf') {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            pdf.text(text, 10, 10, {maxWidth: 180});
            pdf.save(name + ".pdf");
        } else if (target === 'xlsx') {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(text.split('\n').map(r => [r]));
            XLSX.utils.book_append_sheet(wb, ws, "Data");
            XLSX.writeFile(wb, name + ".xlsx");
        } else if (target === 'png') {
            const canvas = document.createElement('canvas');
            canvas.width = 800; canvas.height = 400;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = "black"; ctx.fillRect(0,0,800,400);
            ctx.fillStyle = "#00ff9d"; ctx.font = "16px monospace";
            text.split('\n').forEach((l, i) => ctx.fillText(l, 20, 30 + (i*20)));
            canvas.toBlob(b => saveAs(b, name + ".png"));
        }
        showStatus("CONVERSION_COMPLETE");
    }

    async function startBatch() {
        if (queue.length === 0) return alert("QUEUE_EMPTY");
        const type = document.getElementById('batchTarget').value;
        showStatus("PROCESSING_BATCH...");

        if (type === 'pdf-combined') {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            for (let i=0; i<queue.length; i++) {
                if (i > 0) pdf.addPage();
                const data = await fileToDataURL(queue[i]);
                pdf.addImage(data, 'JPEG', 10, 10, 190, 0);
            }
            pdf.save("batch_export.pdf");
        } else if (type === 'zip') {
            const zip = new JSZip();
            queue.forEach(f => zip.file(f.name, f));
            const blob = await zip.generateAsync({type:"blob"});
            saveAs(blob, "archive.zip");
        } else {
            for (let f of queue) await convertAndDownload(f, type);
        }
        showStatus("ALL_TASKS_COMPLETE");
    }

    function generateDummy() {
        const bytes = getTargetSize();
        if (bytes > 450 * 1024 * 1024) return alert("MEMORY_LIMIT_450MB");
        saveAs(new Blob([new Uint8Array(bytes)]), `null_data_${Date.now()}.dat`);
        showStatus("NULL_FILE_GENERATED");
    }

    async function inflateBatch() {
        const target = getTargetSize();
        for (let f of queue) {
            const extra = Math.max(0, target - f.size);
            saveAs(new Blob([f, new Uint8Array(extra)]), `inflated_${f.name}`);
        }
        showStatus("DATA_INFLATED");
    }

    function getTargetSize() {
        const v = parseFloat(document.getElementById('sizeVal').value);
        return v * (document.getElementById('sizeUnit').value === 'mb' ? 1048576 : 1024);
    }

    // --- HELPER FUNCTIONS ---
    async function convertAndDownload(file, type) {
        let blob = file;
        if (file.name.toLowerCase().endsWith('.heic')) blob = await heic2any({blob: file, toType: "image/jpeg"});
        
        const img = await fileToImage(blob);
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width; canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        if (type === 'scanned') {
            const id = ctx.getImageData(0,0,canvas.width,canvas.height);
            const d = id.data;
            for (let i=0; i<d.length; i+=4) {
                let g = (d[i]+d[i+1]+d[i+2])/3;
                g = g * 1.6 - 50;
                d[i]=d[i+1]=d[i+2] = Math.min(255, Math.max(0, g));
            }
            ctx.putImageData(id, 0, 0);
            canvas.toBlob(b => saveAs(b, "SCANNED_" + file.name), 'image/jpeg', 0.6);
        } else {
            canvas.toBlob(b => saveAs(b, "fixed_" + file.name.split('.')[0] + "." + type), 'image/' + type);
        }
    }

    function fileToDataURL(f) { return new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(f); }); }
    function fileToImage(f) { return new Promise(r => { const i = new Image(); i.onload = () => r(i); fileToDataURL(f).then(u => i.src = u); }); }
</script>
</body>
</html>